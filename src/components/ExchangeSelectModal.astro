---
export interface Props {
  id?: string;
}

const { id = "exchange-modal" } = Astro.props;

const ASTER_IS_READY = true;
---

<div id={id} class="fixed inset-0 z-50 hidden">
  <!-- Backdrop -->
  <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" data-modal-backdrop>
  </div>

  <!-- Modal -->
  <div class="fixed inset-0 flex items-center justify-center p-4">
    <div
      class="bg-aden-dark border border-aden-border rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto relative"
    >
      <!-- Close button -->
      <button
        class="absolute top-4 right-4 text-white/60 hover:text-white transition-colors"
        data-modal-close
        aria-label="닫기"
        data-lang-ko="닫기"
        data-lang-en="X"
      >
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M18 6L6 18M6 6L18 18"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </button>

      <!-- Modal content -->
      <div class="p-6 md:p-8">
        <div
          data-slot="dialog-header"
          class="flex flex-col gap-2 text-center mb-8"
        >
          <h2
            data-slot="dialog-title"
            class="text-white font-pretendard text-2xl md:text-3xl font-bold"
            data-lang-ko="ADEN 거래 시작"
            data-lang-en="Start Trading ADEN"
          >
            ADEN 거래 시작
          </h2>
          <p
            data-slot="dialog-description"
            class="text-white/80 font-pretendard text-sm md:text-base"
            data-lang-ko="거래를 위한 프로토콜을 선택하세요."
            data-lang-en="Select a protocol for trading."
          >
            거래를 위한 프로토콜을 선택하세요.
          </p>
          <p
            class="text-white/50 font-pretendard text-xs mt-1"
            data-lang-ko="거래소 순서는 무작위로 표시됩니다"
            data-lang-en="Exchange order is displayed randomly"
          >
            거래소 순서는 무작위로 표시됩니다
          </p>
        </div>

        <!-- Exchange Options Container -->
        <div
          id="exchange-options"
          class="flex flex-col sm:flex-row gap-3 md:gap-4"
        >
          <!-- Aster Option -->
          {ASTER_IS_READY ? (
            <a
              href="https://app.aden.io"
              target="_blank"
              rel="noopener noreferrer"
              id="aster-option"
              class="border border-aden-border p-4 md:p-6 rounded-2xl block transition-all hover:border-aden-primary/60 hover:bg-aden-primary/5 group relative sm:flex-1"
            >
              <div class="flex flex-col items-center gap-3 md:gap-4">
                <!-- ADEN Logo -->
                <div class="h-10 md:h-12 flex items-center justify-center">
                  <img
                    src="/aden-logo.svg"
                    alt="ADEN Exchange"
                    class="h-10 md:h-12 w-auto"
                  />
                </div>
                <!-- 추천 박스 with ASTER text -->
                <div
                  class="py-0.5 px-2 md:py-1 md:px-2.5 rounded-lg whitespace-nowrap bg-aden-primary/60 flex gap-1 items-center text-[9px] md:text-[10px]"
                >
                  <svg
                    class="w-2 h-2 md:w-2.5 md:h-2.5"
                    viewBox="0 0 10 11"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5.54404 0.851523C5.44367 0.636703 5.23157 0.5 4.99864 0.5C4.76571 0.5 4.55551 0.636703 4.45324 0.851523L3.23557 3.43522L0.516165 3.84923C0.288917 3.88439 0.0995432 4.04843 0.029475 4.27302C-0.0405933 4.4976 0.0162188 4.74562 0.17908 4.91162L2.15235 6.92506L1.68649 9.77045C1.64862 10.0048 1.74331 10.243 1.93079 10.3817C2.11827 10.5204 2.36635 10.5379 2.57087 10.4266L5.00053 9.08888L7.4302 10.4266C7.63472 10.5379 7.8828 10.5223 8.07028 10.3817C8.25776 10.2411 8.35245 10.0048 8.31457 9.77045L7.84682 6.92506L9.82009 4.91162C9.98295 4.74562 10.0417 4.4976 9.9697 4.27302C9.89774 4.04843 9.71026 3.88439 9.48301 3.84923L6.76171 3.43522L5.54404 0.851523Z"
                      fill="white"></path>
                  </svg>
                  <span data-lang-ko="추천" data-lang-en="Recommended">추천</span>
                  <span class="font-semibold">ASTER</span>
                </div>
              </div>
            </a>
          ) : (
            <button
              id="aster-option"
              class="border border-aden-border p-4 md:p-6 rounded-2xl block transition-all hover:border-aden-primary/60 hover:bg-aden-primary/5 group relative sm:flex-1 cursor-pointer"
              onclick="showAsterComingSoon()"
            >
              <div class="flex flex-col items-center gap-3 md:gap-4">
                <!-- ADEN Logo -->
                <div class="h-10 md:h-12 flex items-center justify-center">
                  <img
                    src="/aden-logo.svg"
                    alt="ADEN Exchange"
                    class="h-10 md:h-12 w-auto"
                  />
                </div>
                <!-- 추천 박스 with ASTER text -->
                <div
                  class="py-0.5 px-2 md:py-1 md:px-2.5 rounded-lg whitespace-nowrap bg-aden-primary/60 flex gap-1 items-center text-[9px] md:text-[10px]"
                >
                  <svg
                    class="w-2 h-2 md:w-2.5 md:h-2.5"
                    viewBox="0 0 10 11"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5.54404 0.851523C5.44367 0.636703 5.23157 0.5 4.99864 0.5C4.76571 0.5 4.55551 0.636703 4.45324 0.851523L3.23557 3.43522L0.516165 3.84923C0.288917 3.88439 0.0995432 4.04843 0.029475 4.27302C-0.0405933 4.4976 0.0162188 4.74562 0.17908 4.91162L2.15235 6.92506L1.68649 9.77045C1.64862 10.0048 1.74331 10.243 1.93079 10.3817C2.11827 10.5204 2.36635 10.5379 2.57087 10.4266L5.00053 9.08888L7.4302 10.4266C7.63472 10.5379 7.8828 10.5223 8.07028 10.3817C8.25776 10.2411 8.35245 10.0048 8.31457 9.77045L7.84682 6.92506L9.82009 4.91162C9.98295 4.74562 10.0417 4.4976 9.9697 4.27302C9.89774 4.04843 9.71026 3.88439 9.48301 3.84923L6.76171 3.43522L5.54404 0.851523Z"
                      fill="white"></path>
                  </svg>
                  <span data-lang-ko="추천" data-lang-en="Recommended">추천</span>
                  <span class="font-semibold">ASTER</span>
                </div>
              </div>
            </button>
          )}

          <!-- Orderly Option -->
          <a
            href="https://perp.aden.io"
            target="_blank"
            rel="noopener noreferrer"
            id="orderly-option"
            class="border border-aden-border p-4 md:p-6 rounded-2xl block transition-all hover:border-aden-primary/60 hover:bg-aden-primary/5 group relative sm:flex-1"
          >
            <div class="flex flex-col items-center gap-3 md:gap-4">
              <!-- ADEN Logo -->
              <div class="h-10 md:h-12 flex items-center justify-center">
                <img
                  src="/aden-logo.svg"
                  alt="ADEN Exchange"
                  class="h-10 md:h-12 w-auto"
                />
              </div>
              <!-- 추천 박스 with ORDERLY text -->
              <div
                class="py-0.5 px-2 md:py-1 md:px-2.5 rounded-lg whitespace-nowrap bg-aden-primary/60 flex gap-1 items-center text-[9px] md:text-[10px]"
              >
                <svg
                  class="w-2 h-2 md:w-2.5 md:h-2.5"
                  viewBox="0 0 10 11"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M5.54404 0.851523C5.44367 0.636703 5.23157 0.5 4.99864 0.5C4.76571 0.5 4.55551 0.636703 4.45324 0.851523L3.23557 3.43522L0.516165 3.84923C0.288917 3.88439 0.0995432 4.04843 0.029475 4.27302C-0.0405933 4.4976 0.0162188 4.74562 0.17908 4.91162L2.15235 6.92506L1.68649 9.77045C1.64862 10.0048 1.74331 10.243 1.93079 10.3817C2.11827 10.5204 2.36635 10.5379 2.57087 10.4266L5.00053 9.08888L7.4302 10.4266C7.63472 10.5379 7.8828 10.5223 8.07028 10.3817C8.25776 10.2411 8.35245 10.0048 8.31457 9.77045L7.84682 6.92506L9.82009 4.91162C9.98295 4.74562 10.0417 4.4976 9.9697 4.27302C9.89774 4.04843 9.71026 3.88439 9.48301 3.84923L6.76171 3.43522L5.54404 0.851523Z"
                    fill="white"></path>
                </svg>
                <span data-lang-ko="추천" data-lang-en="Recommended">추천</span>
                <span class="font-semibold">ORDERLY</span>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  // 전역 스코프에 함수 정의
  window.openExchangeModal = function () {
    const modal = document.getElementById("exchange-modal");
    if (modal) {
      // 랜덤하게 순서 변경
      const container = document.getElementById("exchange-options");
      const asterOption = document.getElementById("aster-option");
      const orderlyOption = document.getElementById("orderly-option");

      if (container && asterOption && orderlyOption) {
        // 50% 확률로 순서 변경
        if (Math.random() < 0.5) {
          container.appendChild(orderlyOption);
          container.appendChild(asterOption);
        } else {
          container.appendChild(asterOption);
          container.appendChild(orderlyOption);
        }
      }

      modal.classList.remove("hidden");
      document.body.style.overflow = "hidden";
    }
  };

  window.showAsterComingSoon = function () {
    alert("Aster는 곧 출시됩니다! Coming Soon!");
  };

  // 모달 닫기 기능
  document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("exchange-modal");
    if (modal) {
      const backdrop = modal.querySelector("[data-modal-backdrop]");
      const closeBtn = modal.querySelector("[data-modal-close]");

      const closeModal = () => {
        modal.classList.add("hidden");
        document.body.style.overflow = "";
      };

      if (backdrop) {
        backdrop.addEventListener("click", closeModal);
      }

      if (closeBtn) {
        closeBtn.addEventListener("click", closeModal);
      }

      // ESC 키로 닫기
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && !modal.classList.contains("hidden")) {
          closeModal();
        }
      });
    }
  });
</script>